<html>
<script src="point.js"></script>
<script src="2dg.js"></script>
<script src="polygon.js"></script>

<body>
<canvas id="canvas" width="600" height="500" style="border:1px solid #000000"></canvas>
<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");

init(ctx);
setInterval(redraw, 100);
var width = canvas.width;
var height = canvas.height;
var a = new Point(100, .8 * height);
var b = new Point(.8 * width, 100);
var c = new Point(b.x, a.y);
var e = new Point(0, 0);
var poly = new Polygon(
  [a, b, c],
  [{p: 0, q: 1}, {p: 1, q: 2}, {p: 2, q: 0}]);
poly = new Circle(width / 2, height / 2, width / 4, 100);
var n1 = 1;
var n2 = 2;

var mouse = new Point(141,248);
var mouseStart = new Point(0, 0);
var path = [];
var p = new Point(0, 0);
var q = new Point(1, 0);

canvas.addEventListener('mousedown', function(evt) {
  var x = evt.clientX;
  var y = evt.clientY;
  mouseStart.x = x;
  mouseStart.y = y;
});

canvas.addEventListener('mousemove', function(evt) {
  var rect = canvas.getBoundingClientRect();
  var x = evt.clientX;
  var y = evt.clientY;

  mouse.x = x;
  mouse.y = y;
  p = mouseStart;
  q = mouse;
  if (p instanceof Point && q instanceof Point) {
    if (!poly.contains(p)) {
      var index = n1 / n2;
      path = poly.traceRayFromOutside(p, q, index, 20);
    } else {
      var index = n2 / n1;
      path = poly.traceRayFromInside(p, q, index, 20);
    }
    if (!path) {
      path = [p, q];
    }
  }
});

function redraw() {
  clear(250);
  stroke(0);
  poly.draw();
  stroke(255, 0, 0);
  for (var i = 0; i < path.length - 1; i = i + 1) {
    var p = path[i];
    var q = path[i + 1];
    circle(p.x, p.y, 3);
    line(p, q); 
  }
  fill(100);
  text('n1 = 1', 10, 40);
  text('n2 = ' + n2, canvas.width / 2 + 10, 40);
}

</script>
</body>
</html>
